安装说明

系统需求：Linux(以Ubuntu 9.10为例), Apache + mod_rewrite, PHP5, Mysql, Sun-JDK, GCC, G++, FreePascal
一键安装： 
sudo apt-get install apache2 php5 php5-mysql php5-mysqli php5-mcrypt mysql-server-5.0 fpc sun-java6-jdk gcc g++

*假设是直接用www-data用户搭建, 建议
0. 使用root创建 /home/www-data 并修改所有者
    # mkdir /home/www-data
    # sudo chown -R www-data:www-data /home/www-data
    然后切换用户
    # su www-data

1. co代码，没什么好说了，假设是执行如下命令
    $ cd /home/www-data
    $ svn co http://woj-land.googlecode.com/svn/trunk land
   也就是说所有东西都在land目录里面 

2. 修改 land/tools/create_init_dir.sh (WOJ_ROOT修改为/home/www-data/woj)
   并执行, 就会在 /home/www-data/woj (可以修改脚本) 下创建几个目录，包括
    data, data/1001, temp, upload, log
    data/1001下面还会有data.txt, 1.in, 1.out 3个目录
   链接upload目录 #用于fckeditor上传文件/图片等
    $ cd /home/www-data/land/code/web/index/
    $ ln -sf /home/www-data/woj/upload upload

3. 导入 land/code/web/sql/land.sql
    假设导入的数据库主机在127.0.0.1且库名就是land, 并且假设
    有用户root密码123456可以访问该数据库

4. apache
    启用mod_rewrite, 执行 sudo a2enmod rewrite
    修改配置文件，在ubuntu下是/etc/apache2/sites-enabled/000-default
    找到<Directory /var/www>这一节
    将 AllowOverride None 改成 AllowOverride All
    如果没有 Option FollowSymlinks 也加上一行
    重启apache

5. 在apache的根目录下, 默认是/var/www执行
    $ ln -s /home/www-data/land/code/web/index land

6. 修改配置
    $ cd /home/www-data/land/code/

    //judge的配置
    $ vim judge/config.ini; #将log_file=后面的路径修改为/home/www-data/woj/log/judge.log

    //daemon的配置
    $ vim daemon/config.ini; #将judge_path=后面的路径修改为/home/www-data/land/code/web/wrapper/judge_wrapper.php，LOG_PATH不用理会，是个没用的东西=,=
        # 其他配置可以不用修改，根据具体情况

    //web端和wrapper的配置
    $ cd web/conf
    $ vim db.cfg.php; #修改对应的数据库参数
    $ vim land.cfg.php; #修改对应的值
        # $web_root: 如果前面建立的符号链接不是 land ，那么一定要修改，同时对应修改 land/code/web/index/.htaccess 里面的 /land
        # UPLOAD_PATH 如果前面用的不是upload目录，也要记得修改
        # LOG_FILE 修改为 /home/www-data/woj/log/php.log
        # DEBUG 建议修改为 false
        # DAEMON_HOST/PORT根据前面daemon/config.ini里面的进行修改，默认不用动
    $ vim wrapper.cfg.php #修改相应的路径
          LOG_PATH      = "/home/www-data/woj/log/wrapper.log";
          DATA_PATH     = "/home/www-data/woj/data";
          TEMP_PATH     = "/home/www-data/woj/temp";
          JUDGE_PATH_ROOT    = "/home/www-data/land/code/judge/";

7. 跑起Daemon, 设置judge
    $ cd /home/www-data/land/daemon
    $ screen java Daemon  # 或者 setsid java Daemon > daemon.log 2>&1
    默认应该会正常启动几个线程，并没有错误出现

    $ cd ../judge
    $ su root #切换到root
    $ ./setsuid.sh #给judge_all.exe设置suid位

8. 访问一下服务器的/land试试？
$ w3m http://localhost/land

(a) code/web下的wrapper目录包含的是judge_wrapper, 不是由apache运行的, 是由Daemon调用, 封装judge的。

(b) 调用关系是web_php -> daemon -> judge_wrapper -> judge, 四者可分别以不同的用户运行, 但是必须保证它们都可以写自己的日志文件。

(c) judge虽然可以以普通用户运行,但是属主是root且有suid权限位, 实际上是以root运行的, 可能有一定安全隐患。

(d) 也可以为其他用户专门编译安装一套apache+php，然后通过apache的mod_proxy_http来实现转发访问

(e) Land的默认管理员用户名密码: root 123456
